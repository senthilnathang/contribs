<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<record id="seq_gate_pass" model="ir.sequence">
			<field name="name">Gate Pass</field>
			<field name="code">gatepass.gatepass</field>
			<field name="prefix">GTPS-</field>
			<field name="padding">5</field>
		</record>

		<record id="gate_pass_form_view" model="ir.ui.view">
			<field name="name">gatepass.gatepass.form</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<form>
					<header>
						<button name="move_to_confirmed" string="Confirm"
							type="object"
							attrs="{'invisible': [('state', '=', 'confirmed')]}" />

						<field name="state" widget="statusbar" clickable="true" />
					</header>
					<sheet>
						<h1>
							<field name="name" readonly="1" />
						</h1>
						<group>
							<group>
								<field name="partner_id"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}" />
								<field name="date"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}"
									required="1" />

								<field name="picking_type" required="1"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}" />
								<field name="return_type" required="1"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}" />
								<field name="user_id" options="{'no_create': True}" />
							</group>
							<group>
								<field name="picking_id" required="0"
									attrs="{'readonly': [('state', 'in', ('confirmed'))],'invisible': [('picking_id', '=', False)]}" />
								<field name="vehicle_number" required="0"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}" />
								<field name="bill_number" required="0"
									attrs="{'readonly': [('state', 'in', ('confirmed'))]}" />
								<field name="confirmed_by" readonly="1"
									attrs="{'invisible': [('confirmed_by', '=', False)]}" />
								<field name="confirmed_date" readonly="1"
									attrs="{'invisible': [('confirmed_date', '=', False)]}" />
								<field name="return_picking_id"
									attrs="{'invisible': [('return_type', '=', 'non_returnable')],'invisible': [('return_picking_id', '=', False)]}" />
								<field name="return_date" string="Expected Return Date"
									attrs="{'invisible': [('return_type', '=', 'non_returnable')],'required': [('return_type', '=', 'returnable')]}" />
								<field name="return_gatepass_id"
									attrs="{'invisible': [('return_gatepass_id', '=', False)]}" />
								<field name="remarks" />
							</group>
						</group>
						<button name="get_line_items" type="object"
							class="oe_highlight" string="Get Products"
							attrs="{'invisible': ['|',('picking_id','=',False),('state', 'in', ('confirmed'))]}" />
						<field name="gatepass_line_ids" nolabel="1"
							attrs="{'readonly': [('state', 'in', ('confirmed'))]}">
							<tree editable="bottom">
								<field name="gatepass_id" invisible="1" />
								<field name="product_id" />
								<field name="description" />
								<field name="product_uom_qty" />
								<field name="product_uom" />
								<field name="source_location_id" />
								<field name="dest_location_id" />
							</tree>
							<form>
								<group>
									<group>
										<field name="gatepass_id" />
										<field name="product_id" />
										<field name="description" />
									</group>
									<group>
										<field name="product_uom_qty" />
										<field name="product_uom" required="1" />
										<field name="source_location_id" />
										<field name="dest_location_id" />
									</group>
								</group>
							</form>
						</field>
					</sheet>
				</form>
			</field>
		</record>

		<record id="gate_pass_tree_view" model="ir.ui.view">
			<field name="name">gatepass.gatepass.tree</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<tree decoration-success="state in ('confirmed')"
					decoration-primary="state in ('draft')">
					<field name="name" />
					<field name="date" />
					<field name="picking_type" />
					<field name="return_type" />
					<field name="bill_number" />
					<field name="vehicle_number" />
					<field name="user_id" />
					<field name="picking_id" invisible="1" />
					<field name="state" />
				</tree>
			</field>
		</record>

		<record id="gate_pass_calendar_view" model="ir.ui.view">
			<field name="name">gatepass.gatepass.calendar</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<calendar string="Gate Pass Date" date_start="date">
					<field name="name" />
					<field name="picking_type" />
					<field name="return_type" />
					<field name="state" />
				</calendar>
			</field>
		</record>
		<record id="gate_pass_view_kanban" model="ir.ui.view">
			<field name="name">gatepass.gatepass.kanban</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<kanban class="o_gate_pass_kanban">
					<field name="id" />
					<field name="name" />
					<field name="state" />
					<field name="partner_id" />
					<field name="picking_type" />
					<field name="return_type" />
					<templates>
						<t t-name="kanban-box">
							<div
								class="oe_kanban_global_click o_statutory_tracker_kanban"
								style="margin:2px;">
								<div class="oe_kanban_details">
									<strong class="o_kanban_record_title oe_partner_heading">
										<field name="name" style="color:#7c7bad" />
									</strong>
									<hr class="mt4 mb8" />
									<ul>
										<li t-if="record.partner_id.raw_value">
											<strong>Partner Name:</strong>
											<field name="partner_id" />
										</li>
										<li t-if="record.date.raw_value">
											<strong>Date:</strong>
											<field name="date" />
										</li>
										<li t-if="record.picking_type.raw_value">
											<strong>Picking Type:</strong>
											<field name="picking_type" />
										</li>
										<li t-if="record.return_type.raw_value">
											<strong>Return Type:</strong>
											<field name="return_type" />
										</li>
										<li t-if="record.picking_id.raw_value">
											<strong>Picking:</strong>
											<field name="picking_id" />
										</li>
										<li t-if="record.return_picking_id.raw_value">
											<strong>Return Picking:</strong>
											<field name="return_picking_id" />
										</li>
									</ul>
								</div>
							</div>
						</t>
					</templates>
				</kanban>

			</field>
		</record>
		<record id="gate_pass_view_graph" model="ir.ui.view">
			<field name="name">gatepass.gatepass.graph</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<graph string="Gate Pass Analysis">
					<field name="picking_id" type="row" />
					<field name="gate_pass_count" type="measure" />
				</graph>
			</field>
		</record>

		<record model="ir.ui.view" id="gate_pass_view_pivot">
			<field name="name">gatepass.gatepass.pivot</field>
			<field name="model">gatepass.gatepass</field>
			<field name="arch" type="xml">
				<pivot string="Gate Pass">
					<field name="picking_id" type="row" />
				</pivot>
			</field>
		</record>


        <record id="gate_pass_view_filter" model="ir.ui.view">
            <field name="name">gatepass.gatepass.filter</field>
            <field name="model">gatepass.gatepass</field>
            <field name="arch" type="xml">
                <search string="Gate Pass">
                    <field name="name" />
                    <field name="date" />
                    <field name="picking_type" />
                    <field name="return_type" />
                    <field name="user_id" />
                    <field name="company_id" />
                    <separator/>
                    <filter string="My Activities" name="activities_my"
                        domain="[('user_id', '=', uid)]"/>
                    <separator/>
                    <filter string="Late Activities" name="activities_overdue"
                        domain="[('date', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                        help="Show all records which has next action date is before today"/>
                    <filter string="Today Activities" name="activities_today"
                        domain="[('date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="Future Activities" name="activities_upcoming_all"
                        domain="[('date', '&gt;', context_today().strftime('%Y-%m-%d'))
                        ]"/>
                    <filter string="Returnable" name="returnable"
                        domain="[('return_type', '=', 'returnable')]"/>
                    <filter string="Non-Returnable" name="non_returnable"
                        domain="[('return_type', '=', 'non_returnable')]"/>
                        
                    <filter string="Draft" name="draft"
                        domain="[('state', '=', 'draft')]"/>
                    <filter string="Confirmed" name="confirmed"
                        domain="[('state', '=', 'confirmed')]"/>
                        
                    <filter string="Inward" name="inward"
                        domain="[('picking_type', '=', 'incoming')]"/>
                    <filter string="Outward" name="outward"
                        domain="[('picking_type', '=', 'outgoing')]"/>
                    <filter string="Internal Transfer" name="internal"
                        domain="[('picking_type', '=', 'internal')]"/>
                            
                    <group expand="0" string="Group By">
                        <filter name="group_by_picking_id" string="Picking" context="{'group_by':'picking_id'}"/>
                        <filter name="group_by_source" string="Source Document" context="{'group_by':'bill_number'}"/>
                        <filter name="group_by_user" string="User" context="{'group_by':'user_id'}"/>
                        <filter name="group_by_vehicle" string="Vehicle Number" context="{'group_by':'vehicle_number'}"/>
                        <filter name="group_by_ptype" string="Picking Type" context="{'group_by':'picking_type'}"/>
                        <filter name="status" string="Status" context="{'group_by':'state'}"/>
                        <separator/>
                        <filter string="Planned Date" name="group_by_date" context="{'group_by':'date'}"/>
                    </group>
               </search>
            </field>
        </record>

		<record id="action_gate_pass" model="ir.actions.act_window">
			<field name="name">Gate Pass</field>
			<field name="res_model">gatepass.gatepass</field>
			<field name="context">{'search_default_state':1}
			</field>
			<field name="search_view_id" ref="gate_pass_view_filter" />
			<field name="view_mode">tree,form,calendar,kanban,graph,pivot</field>
		</record>

		<record id="gatepass_view_form_inherit_stock_picking"
			model="ir.ui.view">
			<field name="name">stock.picking.form</field>
			<field name="model">stock.picking</field>
			<field name="inherit_id" ref="stock.view_picking_form" />
			<field name="arch" type="xml">
				<xpath expr="//button[@name='button_validate']"
					position="before">
					<button name="create_gatepass" string="Generate Gate Pass"
						type="object"
						attrs="{'invisible': [('gatepass_id', '!=', False)]}" />
				</xpath>
				<field name="origin" position="after">
					<field name="gatepass_id" domain="[('state','=','draft'),('partner_id','=',partner_id)]"/>
				</field>
			</field>
		</record>

		<menuitem name="Gate Pass" id="menu_gatepass"
			action="action_gate_pass" groups="base.group_user" sequence="14"
			web_icon="gatepass,static/description/icon.png" />

	</data>
</odoo>
